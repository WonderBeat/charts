#	kubectl create job -n bigdata --from="cronjob/liquid8" liquid8

environments:
  default:
    values:
      - secret.yaml
releases:
  - name: liquid-stats
    namespace: bigdata
    chart: main/raw
    values:
      - resources:
          - apiVersion: batch/v1
            kind: CronJob
            metadata:
              name: liquid-stats
              labels:
                app: liquid-stats
            spec:
              schedule: '*/15 * * * *' 
              concurrencyPolicy: Forbid
              successfulJobsHistoryLimit: 1
              failedJobsHistoryLimit: 2
              jobTemplate:
                ttlSecondsAfterFinished: 43200 # 12 hours k8s GC to clean up finished Jobs
                backoffLimit: 0
                spec:
                  template:
                    spec:
                      restartPolicy: Never
                      imagePullSecrets:
                        - name: ghcr-login-secret
                      containers:
                        - name: liquidstats
                          image: ghcr.io/the-analytics-gladiators/liquid8:latest
                          resources:
                            requests:
                              memory: "1G"
                            limits:
                              memory: "2G"
                              cpu: "2"
                          imagePullPolicy: Always
                          env:
                            - name: BSC_WALLET
                              value: "{{ .Values.wallet_bsc }}"
                            - name: trader
                              value: stats
                          command:
                            - /usr/bin/timeout
                            - 15m
                            - java
                            - -Dlogback.configurationFile=â€‹/app/logback.xml
                            - -Dfile.ending=UTF8
                            - -Xmx2G
                            - -jar
                            - /app/app.jar


  - name: liquid8
    namespace: bigdata
    createNamespace: true
    chart: ./liquid8
    values:
      - secret.yaml
