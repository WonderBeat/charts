#	kubectl create job -n bigdata --from="cronjob/liquid8" liquid8

environments:
  default:
    values:
      - secret.yaml
releases:
  - name: liquid-stats
    namespace: bigdata
    chart: main/raw
    values:
      - resources:
          - apiVersion: batch/v1
            kind: CronJob
            metadata:
              name: liquid-stats
              labels:
                app: liquid-stats
            spec:
              schedule: '*/15 * * * *' 
              concurrencyPolicy: Forbid
              successfulJobsHistoryLimit: 1
              failedJobsHistoryLimit: 2
              jobTemplate:
                ttlSecondsAfterFinished: 3200
                backoffLimit: 0
                spec:
                  template:
                    spec:
                      restartPolicy: Never
                      imagePullSecrets:
                        - name: ghcr-login-secret
                      containers:
                        - name: liquidstats
                          image: ghcr.io/the-analytics-gladiators/liquid8:latest
                          resources:
                            requests:
                              memory: "1G"
                            limits:
                              memory: "2G"
                              cpu: "2"
                          imagePullPolicy: Always
                          env:
                            - name: trader
                              value: stats
                          command:
                            - /usr/bin/timeout
                            - 15m
                            - java
                            - -Dlogback.configurationFile=â€‹/app/logback.xml
                            - -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000
                            - -Dfile.ending=UTF8
                            - -Xmx2G
                            - -jar
                            - /app/app.jar


  - name: liquid8
    namespace: bigdata
    createNamespace: true
    chart: ./liquid8
    values:
      - secret.yaml
      - config: |
          wssNodesFile: /wss-nodes.txt
          httpNodesFile: /nodes.txt
          historicalUpdatesBlocks: 7000
          blockchain: binance
          blockBuilderEnabled: true
          trampolineDeadlineMillis: 450
          tradingTokens:
          - 0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c
          - 0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56
          - 0x55d398326f99059fF775485246999027B3197955

  # - name: liquid8-polygon
  #   namespace: bigdata
  #   chart: ./liquid8
  #   values:
  #     - secret.yaml
  #     - config: |
  #         wssNodesFile: /wss-nodes.polygon.txt
  #         httpNodesFile: /nodes.polygon.txt
  #         historicalUpdatesBlocks: 300
  #         blockchain: polygon
  #         blockBuilderEnabled: false
  #         trampolineDeadlineMillis: 2000 # whole block
  #         tradingTokens:
  #           - 0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270
